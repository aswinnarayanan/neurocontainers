name: manual-build

on:
  workflow_dispatch:

jobs:
  build-sif:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v2
      - uses: eWaterCycle/setup-apptainer@v2
        with:
          apptainer-version: 1.3.1
      - name: Run an apptainer container
        run: |
          apptainer registry login --username ${{ github.repository_owner }} --password ${{ secrets.GITHUB_TOKEN }} oras://ghcr.io
          apptainer pull docker://ghcr.io/neurodesk/template_1.0:20231214
          apptainer push ./template_1.0_20231214.sif oras://ghcr.io/${{ github.repository_owner }}/sif/template_1.0:20231214
          